<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description"
        content="Dungeon Delver - An epic roguelike adventure game. Explore mysterious dungeons, lush forests, and scorching deserts!">
    <meta name="theme-color" content="#0a0a0c">
    <title>Dungeon Delver: Legends</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš”ï¸</text></svg>">
</head>

<body>
    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        <div id="ui-layer">
             <!-- Inventory & Skills (Dynamic content handled by script) -->
             <div id="hud-bottom">
                <div class="hud-group" id="weapon-display">
                    <div class="slot weapon-slot" id="slot-weapon">âš”ï¸</div>
                    <span class="key-hint">WEAPON</span>
                </div>
                <div class="hud-group" id="skill-display">
                    <div class="slot skill-slot" id="slot-skill" onclick="game.player.useSkill()">âš¡</div>
                    <span class="key-hint">SKILL (Q)</span>
                    <div class="cooldown-overlay" id="skill-cooldown"></div>
                </div>
                <div class="hud-group" id="inventory-display">
                    <div class="slot item-slot" id="slot-1" onclick="game.useItem(0)">1</div>
                    <div class="slot item-slot" id="slot-2" onclick="game.useItem(1)">2</div>
                    <div class="slot item-slot" id="slot-3" onclick="game.useItem(2)">3</div>
                    <span class="key-hint">INVENTORY (1-3)</span>
                </div>
             </div>
        </div>
        <div id="log-container"></div>
        <canvas id="minimap-container" width="120" height="90"></canvas>

        <!-- CRT Overlay -->
        <div class="crt-overlay"></div>

        <!-- Main Menu -->
        <div id="main-menu" class="menu-screen" style="display:flex">
            <div class="menu-header">
                <div class="logo-icon">âš”ï¸</div>
                <h1>Dungeon Delver: Legends</h1>
                <div class="subtitle">High-Performance Roguelike</div>
            </div>

            <!-- Daily Challenge -->
            <div class="menu-section" style="margin-bottom: 20px;">
                <button class="menu-btn btn-daily" onclick="startDailyChallenge()">
                    ğŸ“… Daily Challenge
                    <div style="font-size: 0.8em; font-weight: normal; margin-top: 5px;">Compete on today's seed!</div>
                </button>
            </div>

            <!-- Class Selection -->
            <div class="menu-section">
                <h2>ğŸ¦¸ Choose Your Hero</h2>
                <div class="class-grid">
                    <div class="class-card selected" onclick="selectClass('knight')" id="class-knight">
                        <div class="class-icon">ğŸ›¡ï¸</div>
                        <div class="class-title">Knight</div>
                        <div class="class-desc">Tanky â€¢ Power Strike</div>
                    </div>
                    <div class="class-card" onclick="selectClass('rogue')" id="class-rogue">
                        <div class="class-icon">ğŸ—¡ï¸</div>
                        <div class="class-title">Rogue</div>
                        <div class="class-desc">Agile â€¢ Shadow Dash</div>
                    </div>
                    <div class="class-card" onclick="selectClass('wizard')" id="class-wizard">
                        <div class="class-icon">ğŸ”®</div>
                        <div class="class-title">Wizard</div>
                        <div class="class-desc">Glass Cannon â€¢ Thunder Nova</div>
                    </div>
                </div>
            </div>

            <div class="menu-section">
                <h2>ğŸ—ºï¸ Choose Your Adventure</h2>
                <div class="mission-grid">
                    <button class="mission-card forest" onclick="selectMission('forest')">
                        <div class="mission-icon">ğŸŒ²</div>
                        <div class="mission-title">Ancient Forest</div>
                        <div class="mission-desc">Beginner â€¢ Explore nature</div>
                        <div class="mission-enemies">Slimes â€¢ Spiders â€¢ Treants</div>
                    </button>
                    <button class="mission-card desert" onclick="selectMission('desert')">
                        <div class="mission-icon">ğŸœï¸</div>
                        <div class="mission-title">Scorched Sands</div>
                        <div class="mission-desc">Moderate â€¢ Deadly heat</div>
                        <div class="mission-enemies">Scorpions â€¢ Mummies â€¢ Sandworms</div>
                    </button>
                    <button class="mission-card dungeon" onclick="selectMission('dungeon')">
                        <div class="mission-icon">ğŸ’€</div>
                        <div class="mission-title">Dark Depths</div>
                        <div class="mission-desc">Hard â€¢ Classic dungeon</div>
                        <div class="mission-enemies">Skeletons â€¢ Ghosts â€¢ Demons</div>
                    </button>
                </div>
            </div>

            <div class="menu-buttons">
                <button class="menu-btn secondary" onclick="showLeaderboard()">ğŸ† Leaderboard</button>
                <button class="menu-btn secondary" onclick="showSettings()">âš™ï¸ Settings</button>
                <button class="menu-btn secondary" onclick="showShop()">ğŸ›’ Shop</button>
            </div>

            <div class="menu-footer">
                <div class="total-coins">ğŸ’° Total Coins: <span id="total-coins">0</span></div>
            </div>
        </div>

        <!-- Leaderboard -->
        <div id="leaderboard-menu" class="menu-screen">
            <h1>ğŸ† Leaderboard</h1>
            <div class="subtitle">Top 10 Scores</div>
            <div id="leaderboard-list" class="leaderboard-container"></div>
            <button class="menu-btn secondary" onclick="hideLeaderboard()">â† Back</button>
        </div>

        <!-- Settings -->
        <div id="settings-menu" class="menu-screen">
            <h1>âš™ï¸ Settings</h1>
            <div class="settings-container">
                <div class="setting-row">
                    <span>ğŸ”Š Sound Effects</span>
                    <label class="toggle">
                        <input type="checkbox" id="sound-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <span>ğŸ“³ Vibration</span>
                    <label class="toggle">
                        <input type="checkbox" id="vibrate-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <span>ğŸ¨ Particles</span>
                    <label class="toggle">
                        <input type="checkbox" id="particles-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            <button class="menu-btn danger" onclick="clearData()">ğŸ—‘ï¸ Clear All Data</button>
            <button class="menu-btn secondary" onclick="hideSettings()">â† Back</button>
        </div>

        <!-- Shop -->
        <div id="shop-menu" class="menu-screen">
            <h1>ğŸ›’ Shop</h1>
            <div class="subtitle">Spend your coins on permanent upgrades!</div>
            <div class="shop-coins">ğŸ’° <span id="shop-coins">0</span></div>
            <div class="shop-container">
                <div class="shop-item" onclick="buyUpgrade('attack')">
                    <div class="shop-icon">âš”ï¸</div>
                    <div class="shop-name">Attack Power</div>
                    <div class="shop-desc">+2 Base Damage</div>
                    <div class="shop-price">ğŸ’° 50</div>
                    <div class="shop-level">Level: <span id="attack-level">0</span></div>
                </div>
                <div class="shop-item" onclick="buyUpgrade('defense')">
                    <div class="shop-icon">ğŸ›¡ï¸</div>
                    <div class="shop-name">Defense Power</div>
                    <div class="shop-desc">+10 Max HP</div>
                    <div class="shop-price">ğŸ’° 50</div>
                    <div class="shop-level">Level: <span id="defense-level">0</span></div>
                </div>
                <div class="shop-item" onclick="buyUpgrade('dash')">
                    <div class="shop-icon">ğŸ’¨</div>
                    <div class="shop-name">Dash Attack</div>
                    <div class="shop-desc">Press SPACE to dash</div>
                    <div class="shop-price">ğŸ’° 100</div>
                    <div class="shop-level" id="dash-status">Not Owned</div>
                </div>
                <div class="shop-item" onclick="buyUpgrade('ranged')">
                    <div class="shop-icon">ğŸ¹</div>
                    <div class="shop-name">Ranged Attack</div>
                    <div class="shop-desc">Press R to shoot</div>
                    <div class="shop-price">ğŸ’° 150</div>
                    <div class="shop-level" id="ranged-status">Not Owned</div>
                </div>
            </div>
            <button class="menu-btn secondary" onclick="hideShop()">â† Back</button>
        </div>

        <!-- Game Over -->
        <div id="game-over" class="menu-screen">
            <h1>ğŸ’€ You Died</h1>
            <div class="subtitle">The darkness claims another soul...</div>
            <button class="menu-btn btn-dungeon" onclick="resetGame()">âš”ï¸ Try Again</button>
            <button class="menu-btn secondary" onclick="showMainMenu()">ğŸ  Main Menu</button>
        </div>

        <!-- Mobile Controls -->
        <div id="controls">
            <div class="dpad">
                <div class="btn btn-up" data-key="ArrowUp">â–²</div>
                <div class="btn btn-left" data-key="ArrowLeft">â—€</div>
                <div class="btn btn-down" data-key="ArrowDown">â–¼</div>
                <div class="btn btn-right" data-key="ArrowRight">â–¶</div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Class Selection Logic
        let selectedClass = localStorage.getItem('selectedClass') || 'knight';
        if (selectedClass === 'warrior') selectedClass = 'knight';
        if (selectedClass === 'mage') selectedClass = 'wizard';

        function selectClass(cls) {
            selectedClass = cls;
            localStorage.setItem('selectedClass', cls);

            // Update UI
            document.querySelectorAll('.class-card').forEach(c => c.classList.remove('selected'));
            const el = document.getElementById('class-' + cls);
            if (el) el.classList.add('selected');
        }

        // Initialize Class Selection UI
        selectClass(selectedClass);

        function startDailyChallenge() {
            // Generate seed from date (YYYYMMDD)
            const today = new Date();
            const seedStr = today.getFullYear().toString() + (today.getMonth()+1).toString().padStart(2, '0') + today.getDate().toString().padStart(2, '0');
            const seed = parseInt(seedStr);

            // Determine biome based on day of week
            const day = today.getDay();
            const biomes = ['dungeon', 'forest', 'desert']; // 0=Sun (dungeon), 1=Mon (forest), etc.
            const biome = biomes[day % 3];

            window.location.href = `${biome}.html?seed=${seed}&daily=true`;
        }

        // Menu functions
        function showLeaderboard() {
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('leaderboard-menu').style.display = 'flex';
            renderLeaderboard();
        }
        function hideLeaderboard() {
            document.getElementById('leaderboard-menu').style.display = 'none';
            document.getElementById('main-menu').style.display = 'flex';
        }
        function showSettings() {
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('settings-menu').style.display = 'flex';
        }
        function hideSettings() {
            document.getElementById('settings-menu').style.display = 'none';
            document.getElementById('main-menu').style.display = 'flex';
        }
        function showShop() {
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('shop-menu').style.display = 'flex';
            updateShop();
        }
        function hideShop() {
            document.getElementById('shop-menu').style.display = 'none';
            document.getElementById('main-menu').style.display = 'flex';
        }
        function renderLeaderboard() {
            const list = document.getElementById('leaderboard-list');
            const scores = game.highScores || [];
            if (scores.length === 0) {
                list.innerHTML = '<div class="no-scores">No scores yet! Play a game first.</div>';
                return;
            }
            list.innerHTML = scores.map((s, i) => `
                <div class="leaderboard-row ${i < 3 ? 'top-' + (i + 1) : ''}">
                    <span class="rank">${i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : '#' + (i + 1)}</span>
                    <span class="biome-icon">${s.daily ? 'ğŸ“…' : (s.biome === 'forest' ? 'ğŸŒ²' : s.biome === 'desert' ? 'ğŸœï¸' : 'ğŸ’€')}</span>
                    <span class="score">${s.score}</span>
                    <span class="depth">Depth ${s.depth}</span>
                </div>
            `).join('');
        }
        function clearData() {
            if (confirm('Are you sure? This will delete ALL your progress!')) {
                localStorage.clear();
                location.reload();
            }
        }
        function updateShop() {
            const upgrades = JSON.parse(localStorage.getItem('upgrades') || '{}');
            document.getElementById('shop-coins').textContent = game.totalCoins || 0;
            document.getElementById('attack-level').textContent = upgrades.attack || 0;
            document.getElementById('defense-level').textContent = upgrades.defense || 0;
            document.getElementById('dash-status').textContent = upgrades.dash ? 'âœ… Owned' : 'Not Owned';
            document.getElementById('ranged-status').textContent = upgrades.ranged ? 'âœ… Owned' : 'Not Owned';
        }
        function buyUpgrade(type) {
            const upgrades = JSON.parse(localStorage.getItem('upgrades') || '{}');
            let cost = (type === 'dash') ? 100 : (type === 'ranged') ? 150 : 50;

            if (game.totalCoins < cost) {
                alert('Not enough coins!');
                return;
            }
            if ((type === 'dash' || type === 'ranged') && upgrades[type]) {
                alert('Already owned!');
                return;
            }

            game.totalCoins -= cost;
            localStorage.setItem('totalCoins', game.totalCoins.toString());

            if (type === 'attack' || type === 'defense') {
                upgrades[type] = (upgrades[type] || 0) + 1;
            } else {
                upgrades[type] = true;
            }
            localStorage.setItem('upgrades', JSON.stringify(upgrades));
            updateShop();
            document.getElementById('total-coins').textContent = game.totalCoins;
        }

        // Initialize
        document.getElementById('total-coins').textContent = game.totalCoins || 0;
    </script>
</body>

</html>