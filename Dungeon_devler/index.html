<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description"
        content="Dungeon Delver - An epic roguelike adventure game. Explore mysterious dungeons, lush forests, and scorching deserts!">
    <meta name="theme-color" content="#0a0a0c">
    <title>Dungeon Legends</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš”ï¸</text></svg>">
</head>

<body>
    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        <div id="ui-layer">
             <!-- Inventory & Skills (Dynamic content handled by script) -->
             <div id="hud-bottom">
                <div class="hud-group" id="weapon-display">
                    <div class="slot weapon-slot" id="slot-weapon" onclick="game.toggleThrow()">âš”ï¸</div>
                    <span class="key-hint">WEAPON</span>
                </div>
                <div class="hud-group" id="skill-display">
                    <div class="slot skill-slot" id="slot-skill" onclick="game.player.useSkill()">âš¡</div>
                    <span class="key-hint">SKILL (Q)</span>
                    <div class="cooldown-overlay" id="skill-cooldown"></div>
                </div>
                <div class="hud-group" id="inventory-display">
                    <div class="slot item-slot" id="slot-1" onclick="game.useItem(0)">1</div>
                    <div class="slot item-slot" id="slot-2" onclick="game.useItem(1)">2</div>
                    <div class="slot item-slot" id="slot-3" onclick="game.useItem(2)">3</div>
                    <span class="key-hint">INVENTORY (1-3)</span>
                </div>
             </div>
        </div>
        <div id="log-container"></div>
        <canvas id="minimap-container" width="120" height="90"></canvas>

        <!-- CRT Overlay -->
        <div class="crt-overlay"></div>

        <!-- Main Menu -->
        <div id="main-menu" class="menu-screen" style="display:flex">
            <canvas id="menu-bg"></canvas>
            <div class="menu-content">
                <div class="menu-header">
                    <div class="logo-icon">âš”ï¸</div>
                    <h1>Dungeon Legends</h1>
                    <div class="subtitle">Tactical Roguelike</div>
                </div>

                <!-- Daily Challenge -->
                <div class="menu-section" style="margin-bottom: 20px;">
                    <button class="menu-btn btn-daily" onclick="startDailyChallenge()">
                        ğŸ“… Daily Challenge
                        <div style="font-size: 0.8em; font-weight: normal; margin-top: 5px;">Compete on today's seed!</div>
                    </button>
                </div>

                <!-- Class Selection -->
                <div class="menu-section">
                    <h2>ğŸ¦¸ Choose Your Hero</h2>
                    <div class="class-grid">
                        <div class="class-card" onclick="selectClass('warrior')" id="class-warrior">
                            <div class="class-icon">ğŸ›¡ï¸</div>
                            <div class="class-title">Warrior</div>
                            <div class="class-desc">Tank â€¢ Whirlwind</div>
                        </div>
                        <div class="class-card" onclick="selectClass('mage')" id="class-mage">
                            <div class="class-icon">ğŸ”¥</div>
                            <div class="class-title">Mage</div>
                            <div class="class-desc">Glass Cannon â€¢ Meteor</div>
                        </div>
                        <div class="class-card" onclick="selectClass('rogue')" id="class-rogue">
                            <div class="class-icon">ğŸ—¡ï¸</div>
                            <div class="class-title">Rogue</div>
                            <div class="class-desc">Assassin â€¢ Shadow Step</div>
                        </div>
                        <div class="class-card" onclick="selectClass('ranger')" id="class-ranger">
                            <div class="class-icon">ğŸ¹</div>
                            <div class="class-title">Ranger</div>
                            <div class="class-desc">Sniper â€¢ Rain of Arrows</div>
                        </div>
                        <div class="class-card" onclick="selectClass('paladin')" id="class-paladin">
                            <div class="class-icon">âœ¨</div>
                            <div class="class-title">Paladin</div>
                            <div class="class-desc">Healer â€¢ Sanctuary</div>
                        </div>
                        <div class="class-card" onclick="selectClass('necromancer')" id="class-necromancer">
                            <div class="class-icon">ğŸ’€</div>
                            <div class="class-title">Necromancer</div>
                            <div class="class-desc">Summoner â€¢ Raise Army</div>
                        </div>
                        <div class="class-card" onclick="selectClass('berserker')" id="class-berserker">
                            <div class="class-icon">ğŸ©¸</div>
                            <div class="class-title">Berserker</div>
                            <div class="class-desc">High Risk â€¢ Undying Rage</div>
                        </div>
                        <div class="class-card" onclick="selectClass('elementalist')" id="class-elementalist">
                            <div class="class-icon">ğŸŒ€</div>
                            <div class="class-title">Elementalist</div>
                            <div class="class-desc">Utility â€¢ Chaos Storm</div>
                        </div>
                    </div>
                </div>

                <div class="menu-section">
                    <h2>ğŸ—ºï¸ Choose Your Adventure</h2>
                    <div class="mission-grid">
                        <button class="mission-card forest" onclick="selectMission('forest')">
                            <div class="mission-icon">ğŸŒ²</div>
                            <div class="mission-title">Enchanted Forest</div>
                            <div class="mission-desc">Beginner â€¢ Entangling Roots</div>
                        </button>
                        <button class="mission-card desert" onclick="selectMission('desert')">
                            <div class="mission-icon">ğŸœï¸</div>
                            <div class="mission-title">Scorched Desert</div>
                            <div class="mission-desc">Moderate â€¢ Sandstorms</div>
                        </button>
                        <button class="mission-card dungeon" onclick="selectMission('dungeon')">
                            <div class="mission-icon">ğŸ’€</div>
                            <div class="mission-title">Ancient Dungeon</div>
                            <div class="mission-desc">Hard â€¢ Hidden Spikes</div>
                        </button>
                    </div>
                </div>

                <div class="menu-buttons">
                    <button class="menu-btn secondary" onclick="showLeaderboard()">ğŸ† Leaderboard</button>
                    <button class="menu-btn secondary" onclick="showSettings()">âš™ï¸ Settings</button>
                    <button class="menu-btn secondary" onclick="showShop()">ğŸ›’ Shop</button>
                </div>

                <div class="menu-footer">
                    <div class="total-coins">ğŸ’° Total Coins: <span id="total-coins">0</span></div>
                </div>
            </div>
        </div>

        <!-- Leaderboard -->
        <div id="leaderboard-menu" class="menu-screen">
            <h1>ğŸ† Leaderboard</h1>
            <div class="subtitle">Top 10 Scores</div>
            <div id="leaderboard-list" class="leaderboard-container"></div>
            <button class="menu-btn secondary" onclick="hideLeaderboard()">â† Back</button>
        </div>

        <!-- Settings -->
        <div id="settings-menu" class="menu-screen">
            <h1>âš™ï¸ Settings</h1>
            <div class="settings-container">
                <div class="setting-row">
                    <span>ğŸ”Š Sound Effects</span>
                    <label class="toggle">
                        <input type="checkbox" id="sound-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <span>ğŸ“³ Vibration</span>
                    <label class="toggle">
                        <input type="checkbox" id="vibrate-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <span>ğŸ¨ Particles</span>
                    <label class="toggle">
                        <input type="checkbox" id="particles-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            <button class="menu-btn danger" onclick="clearData()">ğŸ—‘ï¸ Clear All Data</button>
            <button class="menu-btn secondary" onclick="hideSettings()">â† Back</button>
        </div>

        <!-- Shop -->
        <div id="shop-menu" class="menu-screen">
            <h1>ğŸ›’ Shop</h1>
            <div class="subtitle">Spend your coins on permanent upgrades!</div>
            <div class="shop-coins">ğŸ’° <span id="shop-coins">0</span></div>
            <div class="shop-container">
                <div class="shop-item" onclick="buyUpgrade('attack')">
                    <div class="shop-icon">âš”ï¸</div>
                    <div class="shop-name">Attack Power</div>
                    <div class="shop-desc">+2 Base Damage</div>
                    <div class="shop-price">ğŸ’° 50</div>
                    <div class="shop-level">Level: <span id="attack-level">0</span></div>
                </div>
                <div class="shop-item" onclick="buyUpgrade('defense')">
                    <div class="shop-icon">ğŸ›¡ï¸</div>
                    <div class="shop-name">Defense Power</div>
                    <div class="shop-desc">+10 Max HP</div>
                    <div class="shop-price">ğŸ’° 50</div>
                    <div class="shop-level">Level: <span id="defense-level">0</span></div>
                </div>
            </div>
            <button class="menu-btn secondary" onclick="hideShop()">â† Back</button>
        </div>

        <!-- Game Over -->
        <div id="game-over" class="menu-screen">
            <h1>ğŸ’€ You Died</h1>
            <div class="subtitle">The darkness claims another soul...</div>
            <button class="menu-btn btn-dungeon" onclick="resetGame()">âš”ï¸ Try Again</button>
            <button class="menu-btn secondary" onclick="showMainMenu()">ğŸ  Main Menu</button>
        </div>

        <!-- Mobile Controls -->
        <div id="controls">
            <div class="dpad">
                <div class="btn btn-up" data-key="ArrowUp">â–²</div>
                <div class="btn btn-left" data-key="ArrowLeft">â—€</div>
                <div class="btn btn-wait" data-key="Space">â³</div>
                <div class="btn btn-right" data-key="ArrowRight">â–¶</div>
                <div class="btn btn-down" data-key="ArrowDown">â–¼</div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Class Selection Logic
        let selectedClass = localStorage.getItem('selectedClass') || 'warrior';

        // Migration of old selections
        if (selectedClass === 'knight') selectedClass = 'warrior';
        if (selectedClass === 'wizard') selectedClass = 'mage';

        function selectClass(cls) {
            selectedClass = cls;
            localStorage.setItem('selectedClass', cls);

            // Update UI
            document.querySelectorAll('.class-card').forEach(c => c.classList.remove('selected'));
            const el = document.getElementById('class-' + cls);
            if (el) el.classList.add('selected');
        }

        // Initialize Class Selection UI
        selectClass(selectedClass);

        function selectMission(biome) {
            // Need to handle missing biome files in future, for now standard ones
            window.location.href = biome + '.html';
        }

        function startDailyChallenge() {
            // Generate seed from date (YYYYMMDD)
            const today = new Date();
            const seedStr = today.getFullYear().toString() + (today.getMonth()+1).toString().padStart(2, '0') + today.getDate().toString().padStart(2, '0');
            const seed = parseInt(seedStr);

            // Determine biome based on day of week
            const day = today.getDay();
            const biomes = ['dungeon', 'forest', 'desert']; // 0=Sun (dungeon), 1=Mon (forest), etc.
            const biome = biomes[day % 3];

            window.location.href = `${biome}.html?seed=${seed}&daily=true`;
        }

        // Menu functions
        function showLeaderboard() {
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('leaderboard-menu').style.display = 'flex';
            renderLeaderboard();
        }
        function hideLeaderboard() {
            document.getElementById('leaderboard-menu').style.display = 'none';
            document.getElementById('main-menu').style.display = 'flex';
        }
        function showSettings() {
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('settings-menu').style.display = 'flex';
        }
        function hideSettings() {
            document.getElementById('settings-menu').style.display = 'none';
            document.getElementById('main-menu').style.display = 'flex';
        }
        function showShop() {
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('shop-menu').style.display = 'flex';
            updateShop();
        }
        function hideShop() {
            document.getElementById('shop-menu').style.display = 'none';
            document.getElementById('main-menu').style.display = 'flex';
        }
        function renderLeaderboard() {
            const list = document.getElementById('leaderboard-list');
            const scores = game.highScores || [];
            if (scores.length === 0) {
                list.innerHTML = '<div class="no-scores">No scores yet! Play a game first.</div>';
                return;
            }
            list.innerHTML = scores.map((s, i) => `
                <div class="leaderboard-row ${i < 3 ? 'top-' + (i + 1) : ''}">
                    <span class="rank">${i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : '#' + (i + 1)}</span>
                    <span class="biome-icon">${s.daily ? 'ğŸ“…' : (s.biome === 'forest' ? 'ğŸŒ²' : s.biome === 'desert' ? 'ğŸœï¸' : 'ğŸ’€')}</span>
                    <span class="score">${s.score}</span>
                    <span class="depth">Depth ${s.depth}</span>
                </div>
            `).join('');
        }
        function clearData() {
            if (confirm('Are you sure? This will delete ALL your progress!')) {
                localStorage.clear();
                location.reload();
            }
        }
        function updateShop() {
            const upgrades = JSON.parse(localStorage.getItem('upgrades') || '{}');
            document.getElementById('shop-coins').textContent = game.totalCoins || 0;
            document.getElementById('attack-level').textContent = upgrades.attack || 0;
            document.getElementById('defense-level').textContent = upgrades.defense || 0;
        }
        function buyUpgrade(type) {
            const upgrades = JSON.parse(localStorage.getItem('upgrades') || '{}');
            let cost = 50;

            if (game.totalCoins < cost) {
                alert('Not enough coins!');
                return;
            }

            game.totalCoins -= cost;
            localStorage.setItem('totalCoins', game.totalCoins.toString());

            if (type === 'attack' || type === 'defense') {
                upgrades[type] = (upgrades[type] || 0) + 1;
            }
            localStorage.setItem('upgrades', JSON.stringify(upgrades));
            updateShop();
            document.getElementById('total-coins').textContent = game.totalCoins;
        }

        // Initialize
        document.getElementById('total-coins').textContent = game.totalCoins || 0;
    </script>
</body>

</html>